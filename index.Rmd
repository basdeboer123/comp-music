---
title: "King and Queen of pop"
author: "Bas de Boer"
date: "2/16/2022"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    self_contained: false
    
---

```{r setup, include=FALSE}


library(tidyverse)
library(spotifyr)
library(forcats)
library(plotly)
library(flexdashboard)
library(compmus)
library(reshape)

corpus_king <- get_playlist_audio_features("", "37i9dQZF1DXaTIN6XNquoW")
corpus_queen <- get_playlist_audio_features("", "37i9dQZF1DWTQllLRMgY9S")

best_track_king_billie <- get_track_audio_features(c("2IU9ftOgyRL2caQGWK1jjX", "5ChkMS8OtdzJeqyybCc9R5"))
best_track_queen_vergin <- get_track_audio_features(c("1C2h7mLntPSeVYciMRTF4a", "1ZPlNanZsJSPK5h9YZZFbZ"))
  
combined_corpus <-
  bind_rows(
    corpus_king %>% mutate(category = "King of pop (Michael Jackson)"),
    corpus_queen %>% mutate(category = "Queen of pop (Madonna)")
  )

```

``` {r get_means_mj, include=FALSE}
mean_king <- corpus_king %>%
  summarise(
    mean_danceability = mean(danceability),
    mean_energy = mean(energy),
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_instrumentalness = mean(instrumentalness),
    mean_liveness = mean(liveness),
    mean_valence = mean(valence)
    
  )
```

``` {r get_means_madon, include=FALSE}

mean_queen <- corpus_queen %>%
  summarise(
    mean_danceability = mean(danceability),
    mean_energy = mean(energy),
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_instrumentalness = mean(instrumentalness),
    mean_liveness = mean(liveness),
    mean_valence = mean(valence)
    
  )
```

### Introduction page

The corpus that will be used in this research consists out of the two Spotify "This is:" playlists. The first playlist is the "This Is Micheal Jackson" playlist (containing 65 tracks), the second playlist is the "This Is Madonna" playlist (containing 59 tracks). These playlists are curated by Spotify’s Shows & Editorial team. This is a team of music experts and genres specialists from around the world, hired by Spotify to curate and manage Spotify’s own playlists. 

So, the king and the queen of pop. I choose this corpus because I think both these artists where so good in the music that they made that they became legends, not only in the pop-genre, but for almost every music-lover all over the world. Regardless of the country or age of a person, everybody knows them. The playlist that will be used are on the right side of this page.

This Is Micheal Jackson playlist: https://open.spotify.com/playlist/37i9dQZF1DXaTIN6XNquoW

This Is Madonna playlist: https://open.spotify.com/playlist/37i9dQZF1DWTQllLRMgY9S


The groups that will be compared in this corpus are the artists. What are the features that these two artist have in common? Could this be the features that made them become legends? But also; How do songs of the king and queen of pop defer from each other? In the field of danceability, energy, tempo, instrumentalness, speechiness and more...



One of the possible problems may be in the fact that in the "This is: Micheal jackson" playlist there are also songs of the Jackson five. These songs where of course also iconic for Micheal Jackson, however, they may be a bit less representative for the overall Micheal Jackson playlist. However, there is also a possibility that from these tracks new insights will be derived.

Typical:
Micheal Jackson: "Billie jean", "Smooth criminal" Madonna: "Die another day", "Papa don't preach"

Atypical
Micheal Jackson: "she's Out of my life"(very slow track) Madonna: "Don't cry for me Argentina'
***
Test embedding playlist...

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DXaTIN6XNquoW?utm_source=generator" width="40%" height="380" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>


### Data visualization on track-level features

```{r first_plot, echo=FALSE}
#plot(combined_corpus)


my_fisrt_plot <- combined_corpus %>%
  mutate(mode = ifelse(mode == 0, "Minor", "Major")) %>%
  ggplot(aes(x = energy, y = danceability, color = factor(mode), size = valence, label = track.name)) +
  geom_point(alpha = 0.7) +
  xlim(0, 1) +
  ylim(0, 1) +
  labs(title = "Distribution of songs of the King and Queen of pop over energy, dancebility and valence", size = "") +
  geom_rug(size = 0.1) +
  facet_wrap(~category) +
  scale_color_manual(name = "mode", values = c("lightblue", "steelblue4")) +
  #scale_fill_discrete(name = "New Legend Title") +
  theme_bw()+
  theme(title =element_text(size=8, face='bold'))
  

#my_fisrt_plot
p <- ggplotly(my_fisrt_plot)
p


```
***
Description plot

The following plot shows the dancebility, energy, valence and mode on track-level for the 'This is: Micheal Jackson' playlist and the 'This is: Madonna' playlist next to each other. The x- and y-axis show the energy and dancibility respectively. The size of the dots implicit the valence (musical positiveness) of a track. As you can see are the values clustered around the same place for both artist, however, the tracks of Micheal Jackson are more spread for dancebility as well as for energy. Furthermore, the artists have an equally divided ratio of major- and minor mode tracks. What stands out is that both artists have a few 'outlier' tracks, you can view which tracks these are by hovering over them. These outlier tracks will be analysed as well (To Do).

### Comparizon between Queen and King based on all features (test)

```{r box_plot2, echo=FALSE}

#str(corpus_king)

cat <- combined_corpus %>%
  select(category)

corpus_combined_select <- combined_corpus %>%
  select(danceability, energy, speechiness, acousticness, instrumentalness, liveness, valence) %>%
  mutate(category = cat)

test <- corpus_combined_select[8] %>% pull(category)%>% pull(category)

tester <- ggplot(stack(corpus_combined_select), aes(x = values, y = ind, fill(~test))) +
  geom_boxplot() +
  facet_wrap(~corpus_combined_select[8] %>% pull(category)%>% pull(category))

tester
#str(corpus_combined_select[8] %>% pull(category)%>% pull(category) )
```




### Billie Jean chromagram 

```{r echo=FALSE}

## billie_thriller_deluxe
billie_thriller_deluxe <-
  get_tidy_audio_analysis("5ChkMS8OtdzJeqyybCc9R5") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
## billie_thriller
billie_thriller <-
  get_tidy_audio_analysis("7J1uxwnxfQLu4APicE5Rnj") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r test_chroma, echo=FALSE}

billie_thriller %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude", title = "chromagram Billie Jean Thriller album") +
  theme_minimal() +
  scale_fill_viridis_c()
```

*** 
Description chromagrams

The plot above shows the chromagram for the track Billie Jean by Micheal Jackson. This version of Billie Jean is from the Thriller album in 1982. In the next section this version will be compared to the Billie Jean track from the thriller deluxe album in 2008. The euclidean is used to normalize the pitch classes. As you can see, most energy is concentrated in the pitch classes F# and C#.


### Dynamic Time Warping of two versions of the Billie Jean track 

```{r test_chroma2, echo=FALSE}



compmus_long_distance(
  billie_thriller_deluxe %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  billie_thriller %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Billie Jean (Thriller deluxe album)", y = "Billie Jean (Thriller album)") +
  labs(title = "Distances between chroma vectors Billie Jean versions (Distance metric: euclidean)") +
  theme_minimal() +
  theme(title =element_text(size=6, face='bold')) +
  scale_fill_viridis_c(guide = NULL)

```

```{r test_chroma3, eval=FALSE, include=FALSE}



compmus_long_distance(
  billie_thriller_deluxe %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  billie_thriller %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "chebyshev"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Billie Jean (Thriller deluxe album)", y = "Billie Jean (Thriller album)") +
  labs(title = "Distances between chroma vectors Billie Jean versions (Distance metric: chebyshev)") +
  theme_minimal() +
  theme(title =element_text(size=6, face='bold')) +
  scale_fill_viridis_c(guide = NULL)

```

```{r test_chroma4, eval=FALSE, include=FALSE}



compmus_long_distance(
  billie_thriller_deluxe %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  billie_thriller %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "manhattan"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Billie Jean (Thriller deluxe album)", y = "Billie Jean (Thriller album)") +
  labs(title = "Distances between chroma vectors Billie Jean versions (Distance metric: manhattan)") +
  theme_minimal() +
  theme(title =element_text(size=6, face='bold')) +
  scale_fill_viridis_c(guide = NULL)

```

***
Description dynamic time warping two version

The three plots above show dynamic time warping used to compare the two different version of Billie Jean; three different measures for the distance metric are used (Euclidean, Manhattan and Chebyshev), which metric is used is stated in the title of the plot. For all three different metrics, a clear diagonal line is visible in the graph which shows the similarity between thge two versions. I did not know which of the three graphs shows the similarities/differences between the two versions of Billie Jean best, so if you have suggestions I am happy to hear about it.


### Cepstrogram of Billie Jean
```{r Cepstrogram, echo=FALSE}


bzt <-
  get_tidy_audio_analysis("7J1uxwnxfQLu4APicE5Rnj") %>% # Change URI.
  compmus_align(bars, segments) %>%                     # Change `bars`
  select(bars) %>%                                      #   in all three
  unnest(bars) %>%                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

```

```{r self_sim1, echo = FALSE}
bzt %>%
  compmus_gather_timbre() %>%
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(title = "Cepstrogram of Billie Jean", x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()

```

***
Description

to do


### Self-Similarity Matrix of Billie Jean

```{r real-self-sim-matrix, echo = FALSE}
bzt %>%
  compmus_self_similarity(timbre, "cosine") %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")

```

***
Description:

to do

### Conclusion & discussion 
